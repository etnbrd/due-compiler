<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <title>due</title>
    <meta content="True American is an elaborate drinking game, invented by four respectable personages : Nick, Winston, Schmidt and Coach." name="description">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <style>

      @import url(http://fonts.googleapis.com/css?family=Roboto:100,900);
      @import url(http://fonts.googleapis.com/css?family=Inconsolata:400,700);

      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }

      html, body {
        width: 100%;
        height: 100%;

        font-family: "Roboto";
        font-size: 20pt;
        font-weight: 100;
      }

      h1, h2 {
        font-weight: 900;
      }

      h1 {
        background: yellow;
        padding: 100px 0 0 0;
        font-size: 4em;
      }

      a, button {
        display: block;
        width: 100%;
        
        border: none;
        border-radius: 2px;
        padding: 10px 0 12px 0;
        margin-bottom: 10px;

        text-align: center;
        font-size: 1em;
        font-weight: 900;
        color: black;

        box-shadow: inset 0 -2px 0 0 rgba(50, 50, 50, 0.2);
      }

      a {
        text-decoration: none;
        background: rgb(230, 230, 230);
      }

      button {
        background: rgb(255, 0, 73);
      }



      #source {
        position: absolute;
        top: 0;
        left: 300px;
        bottom: 0;
        right: 0;

        font-family: "Inconsolata";
        font-size: 1em;
      }

      .leftbar, #leftbar {
        position: absolute;

        width: 300px;
        height: 100%;

        left: 0;
        top: 0;
        bottom: 0;

        background: rgba(200, 200, 200, 0.2);

        padding: 10px;
      }

      .due-rupturePoint {
        position: absolute;
        background: rgba(0, 0, 0, 1);
      }

    </style>
</head>

<body>

<div id="leftbar" class="leftbar">
  <a href="index.html">← due</a>
  <button id='compile'>⚒ compile</button>
</div>


<div id="source">
var fs = require('fs');

var source = __dirname;

fs.readdir(source, function(err, files) {
  if (err) throw 'Error finding files: ' + err;

  var total = 0,
      pending = files.length;

  files.forEach(function(filename, fileIndex) {

    fs.stat(source + '/' + filename, function(err, stat) {
      if (err) throw 'Error looking for file: ' + err;

      var control = 0;

      if (stat.isFile())
        fs.readFile(source + '/' + filename, function(err, file) {
          if (err) throw 'Error opening file: ' + err;
          
          control++; // use control

          var lines = String(file).split('\n'),
              number = lines.reduce(function(n, line) {
                return n + (line.length > 0 ? 1 : 0);
              }, 0);

          console.log(filename, ' : \t\t', number);

          total += number;
          pending--;
          if (pending === 0)
            console.log('TOTAL : \t\t', total);
        });
      else
        pending--;
    });
  });
});
</div>

<script src="scripts/script.js"></script>
<script src="scripts/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="scripts/jquery.min.js"></script>

<script type="text/javascript">

var editor = ace.edit("source");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/javascript");

var compiler = window.compiler;

var source = $('#source')[0],
    compile = $('#compile');

function compileSource(e) {
  try {
    compiler(editor.getValue(), updateCode)
  } catch (e) {
    displayError(e);
  }
}


function updateCode(err, code) {
  if (err)
    displayError(err)
  else
    editor.setValue(code);
}

function displayError(err) {
  console.error(err);
}


function test() {
  console.log('test');
  console.log(' ------ ');

  // editor.getSession().setAnnotations([{
  //   row: 0,
  //   column: 1,
  //   text: "Strange error",
  //   type: "information" // also warning and information
  // }]);


  // editor.getSession().setAnnotations([{
  //                 row: editorcursor.row,
  //                 column: editorcursor.column,
  //                 text: "Strange error",
  //                 type: "info"
  //               }]);

  // var markerId = editor.getSession().renderer.addMarker(new Range(1, 10, 1, 15), "warning", "text");

  var session = editor.getSession();

  // console.log(session);

  var Range = ace.require('ace/range').Range

  session.addMarker(
      new Range(1, 5, 3, 2), "due-rupturePoint", undefined, false
   );

  console.log(' ------ ');
}


// compile.click(test)
compile.click(compileSource)

// var code = source.toString();

// compiler(code, function(err, res) {
//     console.log(err, res);
// })

  
// console.log(window.__compiler);

</script>

</body>
</html>